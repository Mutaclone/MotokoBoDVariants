<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nightfury Variant Uploader</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: #e0e0e0; display: flex; justify-content: center; padding: 50px; }
        .card { background: #2d2d2d; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); width: 400px; }
        input, button { width: 100%; margin: 10px 0; padding: 10px; border-radius: 4px; border: none; }
        button { background: #5c7cfa; color: white; cursor: pointer; font-weight: bold; }
        button:disabled { background: #444; }
        .status { margin-top: 15px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="card">
    <h2>Nightfury Variant Uploader</h2>
    
    <label>GitHub Token:</label>
    <input type="password" id="token" placeholder="github_pat_...">
    
    <label>Variant Number:</label>
    <input type="number" id="variantNum" placeholder="e.g. 42">
    
    <label>Texture File (.png):</label>
    <input type="file" id="fileInput" accept="image/png">
    
    <button id="uploadBtn" onclick="handleUpload()">Check & Upload</button>
    
    <div id="status" class="status"></div>
</div>

<script>
    const OWNER = "YOUR_GITHUB_USERNAME";
    const REPO = "YOUR_REPO_NAME";
    const PATH_PREFIX = "assets/bookofdragons/textures/entity/dragons/nightfury/";

    async function handleUpload() {
        const token = document.getElementById('token').value;
        const variant = document.getElementById('variantNum').value;
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('status');
        const btn = document.getElementById('uploadBtn');

        if (!token || !variant || !fileInput.files[0]) {
            status.innerText = "❌ Please fill all fields.";
            return;
        }

        const fileName = `nightfury_${variant}.png`;
        const fullPath = PATH_PREFIX + fileName;
        const file = fileInput.files[0];

        btn.disabled = true;
        status.innerText = "Checking if variant exists...";

        try {
            // 1. Check if file exists
            const checkRes = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${fullPath}`, {
                headers: { 'Authorization': `token ${token}` }
            });

            if (checkRes.status === 200) {
                status.innerText = `❌ Error: Variant ${variant} already exists!`;
                btn.disabled = false;
                return;
            }

            // 2. Convert Image to Base64
            status.innerText = "Reading file...";
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                const content = reader.result.split(',')[1]; // Get base64 part

                // 3. Upload to GitHub
                status.innerText = "Uploading to GitHub...";
                const uploadRes = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${fullPath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Add Nightfury Variant ${variant}`,
                        content: content
                    })
                });

                if (uploadRes.ok) {
                    status.innerText = `✅ Success! Variant ${variant} uploaded. GitHub Action will now trigger.`;
                } else {
                    const err = await uploadRes.json();
                    status.innerText = `❌ Upload failed: ${err.message}`;
                }
                btn.disabled = false;
            };

        } catch (e) {
            status.innerText = `❌ System Error: ${e.message}`;
            btn.disabled = false;
        }
    }
</script>

</body>
</html>
